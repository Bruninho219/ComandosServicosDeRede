#############################################################################################################
SRVAD #######################################################################################################
#############################################################################################################

#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Editar o arquivo /etc/network/interfaces para configurar a placa de rede #//////////////////////////////////#

allow-hotplug enp0s3
iface enp0s3 inet static
    address 192.168.20.4/24
    gateway 192.168.20.1
    dns-nameservers 192.168.20.4 8.8.8.8



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Editar o arquivo /etc/hostname para renomear o servidor #///////////////////////////////////////////////////#

srvad



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Editar o arquivo /etc/hosts para renomear as máquinas em rede #/////////////////////////////////////////////#

192.168.20.4 svdad.empresa.rede srvad



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Editar o arquivo /etc/hosts para configurar pesquisa DNS #//////////////////////////////////////////////////#

domain empresa.rede
search empresa.rede
nameserver 192.168.20.4
nameserver 8.8.8.8



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para instalar os seguintes pacotes #/////////////////////////////////////////#

sudo apt install linux-source
sudo apt install build-essential
sudo apt install ntp
sudo apt install ntpdate
sudo apt install samba
sudo apt install winbind
sudo apt install libnss-winbind
sudo apt install linux-headers-$(uname -r)
sudo apt install acl
sudo apt install attr
sudo apt install ldb-tools
sudo apt install krb5-user
sudo apt install smbclient



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Configuração do Kerberos #//////////////////////////////////////////////////////////////////////////////////#

<NÃO>
empresa.rede
127.0.0.1
127.0.0.1



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para parar os serviços #/////////////////////////////////////////////////////#

sudo systemctl stop smbd
sudo systemctl stop nmbd
sudo systemctl stop winbind



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para disabilitar a inicialização automática dos serviços #///////////////////#

sudo systemctl disable smbd
sudo systemctl disable nmbd
sudo systemctl disable winbind



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite o comando no terminal para verificar se ter algum dos serviços rodando #/////////////////////////////#

sudo ps ax | egreep "smbd|nmbd|winbind"



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite o comando no terminal para apagar o arquivo /etc/samba/smb.conf #////////////////////////////////////#

sudo rm -R /etc/samba/smb.conf



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite o comando no terminal verificar se ter algum dos serviços rodando #//////////////////////////////////#

sudo samba-tool domain provision --use--rfc2307 --interactive

empresa.rede
empresa
dc
SAMBA_INTERNAL
8.8.8.8
@123admin
@123admin



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para copiar o krb5.conf para /etc/  #////////////////////////////////////////#

sudo cp /var/lib/samba/private/krb5.conf /etc/



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para remover proteção de mascara #///////////////////////////////////////////#

sudo systemctl unmask samba-ad-dc



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para habilitar o serviço do samba #///////////////////////////////////////////#

sudo systemctl enable samba-ad-dc



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para iniciar o serviço do samba #////////////////////////////////////////////#

sudo systemctl start samba-ad-dc



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para verificar o status do serviço do samba #////////////////////////////////#

sudo systemctl status samba-ad-dc



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Editar o arquivo /etc/nsswitch.conf para ler os nomes gravado nos dominios #////////////////////////////////#

passwd:         files systemd winbind
group:          files systemd winbind



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite o comando no terminal para reiniciar a máquina #/////////////////////////////////////////////////////#

sudo reboot



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite o comando no terminal para criar o ticket #//////////////////////////////////////////////////////////#

sudo kinit Administrator
@123admin



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite o comando no terminal para verificar se o samba está funcionando #///////////////////////////////////#

sudo smbclient -L empresa.rede -U administrator



#############################################################################################################
FIREWALL ####################################################################################################
#############################################################################################################

#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Editar o arquivo /etc/dhcpd/dhcpd.conf para configurar a ordem DNS #////////////////////////////////////////#

option domain-name-servers 192.168.20.4, 8.8.8.8, 8.8.4.4



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para reiniciar o serviço DHCP #//////////////////////////////////////////////#

sudo /etc/init.d/isc-dhcp-server restart



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Remover complexibilidade da senha #/////////////////////////////////////////////////////////////////////////#

sudo samba-tool domain passwdsettings set --complexity=off --history-length=0 -min-pwd-length=0 -min-pwd-age=0 



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Adicionar ao arquivo nano /etc/samba/smb.conf #/////////////////////////////////////////////////////////////#

[global]
    vsf ofjects=acl_xattr
    map acl inherit=yes
    store dos attibutes=yes

[PROFESSORES]
	path= /samba/professores
	comment= Pasta professores
	read only=no

[PROFESSORES]
	path= /samba/alunos
	comment= Pasta alunos
	read only=no



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para criar os diretórios #///////////////////////////////////////////////////#

mkdir -p /samba/professores
mkdir -p /samba/alunos



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para ativar a permissão estendida #//////////////////////////////////////////#

chmod 0770 -R /samba/professores
chmod 0770 -R /samba/alunos



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para [...] #/////////////////////////////////////////////////////////////////#

chown -R root:"Domain Admins"



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para listar os previlégios #/////////////////////////////////////////////////#

net rpc rights list privileges SeDiskOperatorPrivilege -U "EMPRESA\Administrator"



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para garantir os previlégios de controle de disco #//////////////////////////#

net rpc rights grant "EMPRESA\Domain Admins" SeDiskOperatorPrivilege -U "EMPRESA\Administrator"



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Digite os comandos no terminal para reiniciar o serviço samba #/////////////////////////////////////////////#

smbcontrol all reload-config





#############################################################################################################
WINDOWS 7 ###################################################################################################
#############################################################################################################

#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Colocar máquina no dominio #////////////////////////////////////////////////////////////////////////////////#

Clicar com o botão direito em cima de "Meu computador"
Clicar em "Alterar configurações"
Clicar em "Alterar"
Alterar o membro para "Dominio" e informar o dominio
Reiniciar o computador



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Adicionar ferramentas administrativas #/////////////////////////////////////////////////////////////////////#

Após logar com uma conta administrativa:
Clicar com o botão direito em cima do logo Windows
Clicar em "Propriedades"
Clicar em "Personalizar"
Selecionar a opção para exibir todos os ícones administrativos



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Adicionar grupo #///////////////////////////////////////////////////////////////////////////////////////////#

No menu iniciar, clicar em "Ferramentas administrativas"
Selecionar a opção "Usuários e Computadores do Active Directory"
Na barra de menu, selecionar o item "User"
No menu superior, selecionar a opção para adcionar o grupo
Informe os dados do grupo



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Adicionar usuário #/////////////////////////////////////////////////////////////////////////////////////////#

No menu iniciar, clicar em "Ferramentas administrativas"
Selecionar a opção "Usuários e Computadores do Active Directory"
Na barra de menu, selecionar o item "User"
No menu superior, selecionar a opção para adcionar o usuário
Informe os dados do usuário



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Adicionar usuário ao grupo #////////////////////////////////////////////////////////////////////////////////#

Clique com o botão direito em cima do grupo desejado, e selecione "Propriedades"
Selecione a aba "Membros", e depois em "Adcionar"
Informe o nome do usuário e selecione "Verificar nomes" e adicione o membro desejado



#///////////////////////////////////////////////////////////////////////////////////////////////////////////#
Controle de compartilhamento e segurança #//////////////////////////////////////////////////////////////////#

No menu iniciar, clicar em "Ferramentas administrativas"
Selecionar a opção "Gerenciamento do computador"
Clicar com o botão direito sobre "Gerenciamento do computador"
Selecionar o servidor correto e confirmar

Selecione o menu "Pastas compartilhadas"
Clique com o botão direito em cima da pasta correspondente
Selecione a "Propriedades"
Selecionar a aba "Permissões de compartilhamento"
Adicione o usuário correspondente
Selecione as permissões
Remova o grupo "Todos"